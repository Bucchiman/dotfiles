<!-- FileName: vslam
 Author: 8ucchiman
 CreatedDate: 2023-03-15 17:06:58 +0900
 LastModified: 2023-03-27 11:09:18 +0900
 Reference: 8ucchiman.jp
-->


# 全体的なアルゴリズム
## カメラのキャリブレーション
カメラの内部パラメータKの推定が必要
エピポーラ幾何により求めることが困難

チェス盤の画像を複数の角度から撮影
 - 焦点距離
 - 画像の中心
 - レンズの歪み

## マップの初期化

## トラッキング&マップの更新



# 座標変換
3D点を画像平面に投影するためには、ワールド座標系->カメラ座標系->画像座標系
の順に変換する。
カメラ->画像の変換を表すのが内部パラメータ, ワールド座標系->カメラ座標系を表すのが外部パラメータである。

## カメラの投影モデル
各軸の焦点距離を(fu, fv)、光学中心を(cu, cv)とする。内部パラメータKは以下のように定義できる。
```
       | fu  0  cu |
   K = | 0   fv cv |
       | 0   0  1  |
```
$
    K = \begin{pmatrix} f_u & 0   & c_u \\
                        0   & f_v & c_v \\
                        0   & 0   & 1 \end{pmatrix}
$


Kの第3行をのぞいた行列をK'とする。
カメラ座標系の3D点
$χc=\begin{pmatrix}X_c & Y_c & Z_c\end{pmatrix}^T$
は以下の式で画像平面上の点
$z=\begin{pmatrix}u & v\end{pmatrix}^T$
に投影される。
```
    z = 1 / Zc K'χc
```

ワールド座標系->カメラ座標系の変換は各カメラの外部パラメータを考える必要がある。
カメラの位置姿勢が並進ベクトルtcwと回転行列Rcwで表されるとき、ワールド座標系の3D点χw=(Xw, Yw, Zw)Tをカメラ座標系に変換すると、
χc=[Rcw|tcw]χwとなる。
```
    z = 1/Zc K'[Rcw|tcw]χw
```






# エピポーラ幾何
3次元のシーンを撮影した画像間の対応点には拘束条件がある。
それを表す時が基礎行列Fと基本行列Eである。
2つのカメラと3D点の空間的対応関係は、エピポーラ幾何と呼ぶ。
基礎行列Fは画像座標系, 基本行列Eはカメラ座標系での拘束条件を表し、カメラの内部パラメータKが既知の場合は基本行列Eを、未知の場合は基礎行列Fを用いることで、
カメラ姿勢[R|t]を推定することができる。


## 基礎行列
基礎行列Fは3x3行列,カメラの内部パラメータKと2つのカメラの外部パラメータ[R|t]の両方の情報を含む。
これはエピポーラ拘束と呼ばれ、一方のz1が決まればもういっおぷの画像上の対応店z2に関する制約を与えることができる。

```
            | f11 f12 f13 ||u1|
   (u2 v2 1)| f21 f22 f23 ||v1| = z2TFz1 = 0
            | f31 f32 f33 ||1 |
```

画像I1上の点z1に対応する画像I2上のエピポーラ線はI2=Fz1であらわされる。


## 基本行列
基本行列Eは対応店ペアpとp'の幾何関係を表す行列である。
基本行列は回転行列Rとtを歪対称行列表現に変換した[t]xの積で計算される。
```
    E = R[t]x
```

ここで、エピポーラ拘束により、Cp, C'p', tの3つのベクトルが同一平面上に存在するので、基本行列Eを用いて2画像間のエピポーラ拘束を表現できる。+
```
    p'TEp = 0
```
