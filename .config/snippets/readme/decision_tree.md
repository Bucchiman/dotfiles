<!--
 FileName:      decision_tree
 Author:        8ucchiman
 CreatedDate:   2023-04-26 16:53:11
 LastModified:  2023-01-25 10:56:12 +0900
 Reference:     https://fresopiya.com/2019/06/10/desisiontreeid3/
 Description:   ---
-->


# Decision Tree
どのような質問をどの順番で行うか決める必要がある。
その時、代表的なアルゴリズムとして次のようなものがある。
- ID3(iterative dichotomiser 3)
- C4,5
- CART
- CHAID

## ID3(iterative dichotomiser 3)
各独立変数に対し、変数の値を決定した場合における平均情報量の期待値を求める。
その中で最大のものを選び、それを木のノードにする操作を再帰的に行う。
- 0. 学習データ準備
- 1. ルートノードNを作成し、全データを所属させる。
- 2. Nに所属するデータがすべて同じ分類先なら、処理を終了。
- 3. Nに所属するデータのばらつき度合い(平均情報量)を計算。
- 4. 各変数を質問とした時のばらつき度合い(平均情報量)を求める。
- 5. 各変数を質問とした時の情報利得を計算。
- 6. 情報利得が最も大きい質問を選択し、分割後のデータを新たな集合とみなし、操作を繰り返す。


### 0. 学習データ準備
|         |   食性   | 発生形態 | 体温 |   分類    |
|---------|----------|----------|------|-----------|
| penguin |   肉食   |   卵生   | 恒温 | bird      |
|  lion   |   肉食   |   胎生   | 恒温 | mammalian |
|   cow   |   草食   |   胎生   | 恒温 | mammalian |
| lizard  |   肉食   |   卵生   | 変温 | reptiles  |
| chicken |   草食   |   卵生   | 恒温 | bird      |


### 1. ルートノードNを作成し、全データを所属させる。
```
   +-N-------------------+
   | *penguin ***lizard  |  - *bird
   | **lion     *chicken |  - **mammalian
   | **cow               |  - ***reptiles
   +---------------------+
```

### 2. Nに所属するデータがすべて同じ分類先なら、処理を終了。
pass

### 3. Nに所属するデータのばらつき度合い(平均情報量)を計算。
- 集合Cにおいて、D中のxが起こる確率を$p_x(C)$
```
   C: *penguin, **lion, **cow, ***lizard, *chicken
   D: *bird, **mammalian, ***reptiles
```

$ M(C) = -\sum_{x\in D} p_{x}(C)\log{p_{x}(C)} $
$ M(C) = -\frac{2}{5}\log_{3}{\frac{2}{5}} -\frac{2}{5}\log_{3}{\frac{2}{5}} -\frac{1}{5}\log_{3}{\frac{1}{5}} = 0.96 $

### 4. 各変数を質問とした時のばらつき度合い(平均情報量)を求める。

```
   +-N-------------------+  肉食or草食   +-N'--------+  +-N"--------+
   | *penguin ***lizard  | ----------->  | *penguin  |  | **cow     |
   | **lion     *chicken |               | **lion    |  | *chicken  |
   | **cow               |               | ***lizard |  +-----------+
   +---------------------+               +-----------+

                            卵生or胎生
                           ----------->  +-N'--------+  +-N"--------+
                                         | *penguin  |  | **cow     |
                                         | *chicken  |  | **lion    |
                                         | ***lizard |  +-----------+
                                         +-----------+

                            恒温or変温
                           ---------->   +-N'--------+  +-N"--------+
                                         | *penguin  |  | ***lizard |
                                         | *chicken  |  +-----------+
                                         | **lion    |
                                         | **cow     |
                                         +-----------+
```
 - 肉食or草食
    - 肉食の平均情報量
        $ -\frac{1}{3}\log_{3}{\frac{1}{3}} -\frac{1}{3}\log_{3}{\frac{1}{3}} -\frac{1}{3}\log_{3}{\frac{1}{3}} = 1.0 $
    - 草食の平均情報慮
        $ -\frac{1}{2}\log_{3}{\frac{1}{2}} -\frac{1}{2}\log_{3}{\frac{1}{2}} -\frac{0}{2}\log_{3}{\frac{0}{2}} = 0.631 $
    - 平均情報量の平均値
        $1.0\times\frac{3}{5} + 0.631\times\frac{2}{5} = 0.852 $

 - 卵生or胎生
    0.348

 - 恒温or変温
    0.505

平均情報量はデータのばらつきとして用いることができる。
肉食or草食ではbird, mammalian, reptilesがまんべんなく散らばっているため、平均情報量が最も大きくなっている。


### 5. 各変数を質問とした時の情報利得を計算。
どの質問を分岐に使ったらいいのかを判断するのに、平均情報量をもとに情報利得を用いる。
情報利得は、ある質問をしてデータを分割した結果、どれくらいエントロピーが減少したかを表す指標です。
もともとの平均情報量から、質問によるデータ分割後の平均情報量を引いた値であらわされる。
この値が大きければ、より有益な質問といえる。

- 肉食or草食
$ 0.96 - 0.852 = 0.108 $

- 卵生or胎生
$ 0.96 - 0.348 = 0.612 $

- 恒温or変温
$ 0.96 - 0.505 = 0.455 $

卵生か胎生かの質問の情報利得が最も大きいため、この質問が最も有益である。

### 6. 情報利得が最も大きい質問を選択し、分割後のデータを新たな集合とみなし、操作を繰り返す。

```
   +-N-------------------+  卵生or胎生   +-N'--------+  +-N"--------+
   | *penguin ***lizard  | ----------->  | *penguin  |  | **cow     |
   | **lion     *chicken |               | *chicken  |  | **lion    |
   | **cow               |               | ***lizard |  +-----------+
   +---------------------+               +-----------+
                                               |              |
                                               v              v
                                          繰り返し処理    処理終了

```


## アルゴリズム別理解
 - ID3
 - C4,5
 - CART
 - CHAID
